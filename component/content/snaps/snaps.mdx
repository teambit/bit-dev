import firstSnap from './first-snap.png';
import firstSnapHistory from './first-snap-history.png';
import secondSnap from './second-snap.png';
import snapDependency from './snap-dependency.png';
import snapOverview from './snap-overview.png';

# Component Snapshots

:::note Missing UI Capabilities

`snap` is safe to use it in your workflow. However, snapshots are not represented well in the UI.  
This feature is still under development.

:::

Snaps allow recoding of changes on components alongside a message describing the change. Use snaps to share changes of a component to collaborate with your team on components. Snapshots are immutable, when they are saved to Bit and published, you can't change them, similar to a commit in Git.

In Bit you manage changes across connected components, this guide follows how snaping changes work for components that have dependencies on each other.  
The guide follows sharing changes for `ui/text` and `ui/heading` in a worksapce with 4 connected components.

<img src={snapOverview} style={{ maxHeight:'250px' }}/>

## Snap a Single Component

To record our first snapshot we use the `snap` command

```bash
bit snap ui/text --message "a demo snapshot"
```

During the `snap` process, Bit runs the full component [build pipeline](/docs/dev-services/builder/build-pipelines#build-pipelines), as defined in its environment.  
When done, can see the new revision in the component's **changelog** tab in the workspace-ui:

<img src={firstSnapHistory} />

Use the CLI with the `log` command:

```bash
bit log ui/text
```

```
snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 12:25:52 PM

      a demo snapshot
```

We can also run `status` command.

```
bit status
```

We have a snapped component, which means we can either set a semantic version to it (more on that later), or export it to a remote scope.

```
new components
(use "bit tag --all [version]" to lock a version with all your changes)

     > pages/welcome ... ok
     > ui/card ... ok
     > ui/heading ... ok
                         
snapped components
(use "bit tag --all [version]" or "bit tag --snapped [version]" to lock a version)

     > ui/text ... ok
                         
staged components
(use "bit export <remote_scope> to push these components to a remote scope")

     > ui/text. versions: 2ec9427e94b56bd3ed886b7eea42e84563001f5d ... ok
```

### Exporting Snaps

To share a state of a component with others we must first log it to the component history using `snap`. This makes a component to be staged for export.  
Export snaps using `export` command:

```bash
bit export
```

Read more [here](docs/workspace/exporting-components).

### Tracking New Changes

As components are not only built from source code, there are various things that Bit considers as "changes" for a component:

- Modification in any of the component files.
- New file added.
- File removed.
- Dependenty version update.
- Configuration changed.

Change any of the files in `demo/ui/text`, and then run `snap` again:

```bash
bit snap ui/text --message "my second snapshot"
```

When we run `bit log` for `ui/text` again, we see the updated revision history:

```
snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 14:25:52 PM

      my second snapshot

snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 12:25:52 PM

      a demo snapshot
```

## Snapshots with Linked Components

Components may depend on each other. When this happens, Bit logs this relationship as part of the snapshot.  
In this example, `ui/heading` depends on `ui/text`, so when we snap `ui/heading`, we link it to the snap made for `ui/text`.

```bash
bit snap ui/heading --message "see my dependency"
```

The snap for `ui/heading` now depends on `ui/text`'s snap.

## Undoing Snapshots

We can `reset` staged components, i.e., components that were snapped by not yet exported to a remote scope.  
Bit `reset` reverts the component to its previous state, i.e., `new`, `modified` or `exported`.


```bash
bit reset ui/text # Use bit reset to remote all staged snapshots from a component
bit reset --all # reset all versions from all components
```

This will remove all un-exported snapshots from the local component history. `reset` does not revert code changes made in the component.

##  Snapshot in the Workspace

Bit understands the internal dependency graph of your workspace, and how your components are connected. SO while you can use the `snap` command per component, it accepts several features that simplify the flow when working with many components.

### Snapshot Modified Components

Use the `--all` flags to snapshot all modified components in the workspace. Bit will create a snap for each component, and if there are components with dependency relationships between them, their recent snapshots will be connected.  
With this feature, all snapshots will have the same log message.

```bash
bit snap --all --message "updating several components"
```

### Snapshot by Pattern

If you need to set different log message according to component namespaces, use a pattern to select the components you want to snap.

```bash
bit snap ui/* --message "one message for my ui components"
bit snap pages/* --message "another message for my pages"
```

### Auto-Snap Dependents

When you run `bit snap`, Bit can automatically snap all dependents of the component you are working on. Snap will propagate through all the dependents, and create a new snapshot for each of them.

```bash
bit snap ui/heading --message "my heading" --auto-snap-dependents
```

## How Bit Stores Snapshots

### Contents of a Snapshot

When a snap of a component is created, Bit creates a new object for it, and points to it from the component.

<img src={firstSnap} style={{ maxHeight:'300px' }} />

- Source code.
- Dependencies.
- Metadata (log message, author, date, etc).
- Various generated artifacts (docs, test results, npm package, etc).

### Snap Revision History

When a new snap is created, Bit creates a new snapshot all changes and builds the revision history:

1. Sets current snapshot as the predecessor of the new snapshot.
1. Updates the component to point to it as the latest snapshot.

<img src={secondSnap}  style={{ maxHeight:'200px' }} />

### Dependencies in Snapshots

Dependencies between snapshots of different components are managed as a graph, meaning that if a snapshot of `ui/heading` depends on a specific snapshot of `ui/text`, Bit links them.

<img src={snapDependency}  style={{ maxHeight:'200px' }} />
