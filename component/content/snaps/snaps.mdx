import firstSnap from './first-snap.png';
import firstSnapHistory from './first-snap-history.png';
import secondSnap from './second-snap.png';
import snapDependency from './snap-dependency.png';

# Component Snapshots

:::note Missing UI Capabilities

`snap` is safe to use it in your workflow. However, snapshots are not represented well in the UI.  
This feature is still under development.

:::

Snaps allow recoding of changes on components. They record the state of a component, alongside a message describing the change, to build a component revision history.  
A snapshot contains source code, config, dependencies and metadata information on the component. Each snapshot has a unique hash, so you can later revisit. Snaps are similar to commits in Git. Snapshots are immutable, when they are saved to Bit and published, you can't change them.

## Snapshoting a Component

To showcase how snaps work, create a new workspace and add your first component. For this demo we'll use a basic demo project, as it has a few components to start with.

```bash
bit new react snapshot-demo
cd snapshot-demo
```

All components in this project are new, so none of them has any snapshots. To record our first snapshot we use the `snap` command

```bash
bit snap ui/text --message "a demo snapshot"
```

During the `snap` process, Bit runs the full component [build pipeline](/docs/dev-services/builder/build-pipelines#build-pipelines), as defined in its environment.  
When done, can see the new revision in the component's **changelog** tab in the workspace-ui:

<img src={firstSnapHistory} />

:::info Snapshot contents

When a snap of a component is created, Bit creates a new object for it, and points to it from the component.

<img src={firstSnap} style={{ maxHeight:'300px' }} />

- Source code
- Dependencies (`package.json`)
- Metadata (log message, author, date, etc)
- Various generated artifacts (docs, test results, npm package, etc).

:::

Use the CLI with the `log` command:

```bash
bit log ui/text
```

```
snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 12:25:52 PM

      a demo snapshot
```

We can also run `status` command.

```
bit status
```

We have a snapped component, which means we can either set a semantic version to it (more on that later), or export it to a remote scope.

```
new components
(use "bit tag --all [version]" to lock a version with all your changes)

     > pages/welcome ... ok
     > ui/card ... ok
     > ui/heading ... ok
                         
snapped components
(use "bit tag --all [version]" or "bit tag --snapped [version]" to lock a version)

     > ui/text ... ok
                         
staged components
(use "bit export <remote_scope> to push these components to a remote scope")

     > ui/text. versions: 2ec9427e94b56bd3ed886b7eea42e84563001f5d ... ok
```

## Exporting Snaps

To share a state of a component with others we must first log it to the component history using `snap`. This makes a component to be staged for export.  
Export snaps using `export` command:

```bash
bit export
```

Read more [here](docs/workspace/exporting-components).

## Tracking New Changes

As components are not only built from source code, there are various things that Bit considers as "changes" for a component:

- Modification in any of the component files.
- New file added.
- File removed.
- Dependenty version update.
- Configuration changed.

Change any of the files in `demo/ui/text`, and then run `snap` again:

```bash
bit snap ui/text --message "my second snapshot"
```

When we run `bit log` for `ui/text` again, we see the updated revision history:

```
snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 14:25:52 PM

      my second snapshot

snap 2ec9427e94b56bd3ed886b7eea42e84563001f5d
author: itaymendel <itay@mydomain.com>
date: 11/14/2021, 12:25:52 PM

      a demo snapshot
```

:::info Revision History

Bit creates a new snapshot for the component with the new changes and builds the revision history:

1. Sets current snapshot as the predecessor of the new snapshot.
1. Updates the component to point to it as the latest snapshot.

<img src={secondSnap}  style={{ maxHeight:'200px' }} />

:::

### Visualize Past Snapshots

Each snapshot in the component history contains the built artifacts for the component, including rendering and docs. This means you can use Workspace UI to get a view on how a component looked like in past.

```
bit start
```

Each component has a version-drop-down menu you can use to see the past revisions of the component. Or you can use the **changelog** tab to jump to past snaps.

## Dependencies Between Snapshots

Components may depend on each other. When this happens, Bit logs this relationship as part of the snapshot using a pointer.  
To get started, let's create a dependency relationship between `ui/heading` and `ui/text`. To do that edit the file `demo/ui/heading/heading.js` and add the following line:

```js
import Text from '@company/scope.ui.text'
```

Let's see the dependencies for `ui/heading`

```bash
bit show ui/heading
```

See that it depends on a snapshot of `ui/text`:

```bash
...
├───────────────────┼──────────────────────────────────────────────────────────────────────────────┤
│ dependencies      │ @company/scope.ui.text@5a88dda49403d8becbb33736de33836bd6ca9fbc- (component) │
│                   │ classnames@2.3.1------------------------------------------------ (package)   │
│                   │ core-js@^3.0.0-------------------------------------------------- (package)   │
├───────────────────┼──────────────────────────────────────────────────────────────────────────────┤
...
```

Now we can run `bit snap`, but this time run it for `ui/heading`:

```bash
bit snap ui/heading --message "see my dependency"
```

As each snapshot is immutable, the dependency graph for each snaphot does not change. When you update a dependency and create a new snapshot, you also need to create a new snapshot for dependents.

:::info Dependencies in Snapshots

New snapshot for `ui/heading` depends on the second snapshot of `ui/text`.

<img src={snapDependency}  style={{ maxHeight:'200px' }} />

:::

##  Snapshot in the Workspace

Bit understands the internal dependency graph of your workspace, and how your components are connected. SO while you can use the `snap` command per component, it accepts several features that simplify the flow when working with many components.

### Snapshot Modified Components

Use the `--all` flags to snapshot all modified components in the workspace. Bit will create a snap for each component, and if there are components with dependency relationships between them, their recent snapshots will be connected.  
With this feature, all snapshots will have the same log message.

```bash
bit snap --all --message "updating several components"
```

### Snapshot by Pattern

If you need to set different log message according to component namespaces, use a pattern to select the components you want to snap.

```bash
bit snap ui/* --message "one message for my ui components"
bit snap pages/* --message "another message for my pages"
```

### Auto-Snap Dependents

When you run `bit snap`, Bit can automatically snap all dependents of the component you are working on. Snap will propagate through all the dependents, and create a new snapshot for each of them.

```bash
bit snap ui/heading --message "my heading" --auto-snap-dependents
```

## Undoing Snapshots

We can `reset` staged components, i.e., components that were snapped by not yet exported to a remote scope.  
Bit `reset` reverts the component to its previous state, i.e., `new`, `modified` or `exported`.

:::info reset does not revert code changes made in the component.
:::

```bash
bit reset ui/text # Use bit reset to remote all staged snapshots from a component
bit reset foo/bar 1.0.0 # reset specific local version
bit reset --all 0.11.4 # reset a version from all components
bit reset --all # reset all versions from all components
```

This will remove all un-exported snapshots from the local component history.
