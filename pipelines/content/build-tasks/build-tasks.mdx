# Build tasks

Build tasks are component development operations that are executed in sequence, in one or more build pipelines (build pipeline, snap pipeline, or tag pipeline).

Build tasks are registered to the build pipelines, either by Envs using the [Builder service handlers](build-pipelines#add-a-build-task-from-an-env), or by Aspects (in general), using the [Builder registration API](build-pipelines#add-a-build-task-from-any-aspect).

The easiest way to start implementing a Build Task is by using the 'build-task' template:

```bash
bit create build-task modules/my-task
```

Alternatively, you can import an example build task component (and edit it in your own workspace):

```bash
bit import teambit.pipelines/examples/modules/loc-stats
```

## Provide the Build Task with Identification

To identify your build task in various outputs and logs, provide it with a task name (`name`) and with the Aspect ID (`aspectId`) of the aspect that registered it.

Since the Aspect ID may change (based on the aspect registering the build task), it is best to set it only when the build task is instantiated.

```ts
export class MyTask implements BuildTask {
  constructor(readonly aspectId: string) {}
  readonly name = 'MyBuildTask';
}
```

## Process the Relevant Components

The build task receives the Build context (`context`) from the Builder aspect. It provides data regarding all the Capsules that were generated in this build process.

In most cases, the Capsules you should care about are the 'Seeder Capsules' (`seedersCapsules`).
These are the Capsules that are intentionally being built (in contrast to those that are only needed by the build process as dependencies of the components intentionally being built).

Build tasks run on sets of components which are grouped by their Env. That means a different set of 'Seeder Capsules' will be available for different instances of the build task, depending on the Env (for example, when the task runs over React Env's components, the seeders capsules will only be component using the React Env)

Iterate over each Component Capsule to process its files.

```ts
  async execute(context: BuildContext): Promise<BuiltTaskResult> {
    const capsules = context.capsuleNetwork.seedersCapsules;
    capsules.forEach((capsule) => {
      console.log(`This component's name is: ${capsule.component.id.name}`);
    }
    return {
      // ...
    }
  }
```

## Save New Data in the Component Metadata

Build tasks must return data regarding the components they processed (`componentsResults`). The 'component results' can also be used to include data regarding the build execution such as errors, start and end timestamps, etc.
When tasks are executed as part of the snap or tag processes, this data gets persisted in the component version (as component metadata).

```ts
  async execute(context: BuildContext): Promise<BuiltTaskResult> {
    // ...
    const componentsResults: ComponentResult[];
    const capsules = context.capsuleNetwork.seedersCapsules;
    capsules.forEach((capsule) => {
      componentsResults.push(capsule.component)
    }
    return {
      componentsResults,
    };
  }
```

## Save New Artifacts in the Component Artifacts

Artifacts generated (in each component's capsule) can be persisted in the component version (when the task is executed as part of the tag or snap processes).
This is done by selecting the relevant artifacts using a glob pattern, and providing them with a description (artifacts that are not selected will not be persisted).

Note that a single task may return more than a single set of artifacts. In that case, the name (`name`) given for them should distinguish one set of artifacts from another (for example, a single compilation task that generates code transpiled to 'ES2015' and 'ES2020' standards)

```ts
  async execute(context: BuildContext): Promise<BuiltTaskResult> {
  // ...
    return {
      artifacts: [
        {
          generatedBy: this.aspectId,
          name: `component snapshots`,
          globPatterns: [`snapshots/**`],
        },
      ],
      componentsResults,
    };
  }
```
